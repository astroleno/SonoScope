# 智谱AI GLM-4.5 配置说明

## 1. 获取API密钥

1. 访问 [智谱AI开放平台](https://open.bigmodel.cn/usercenter/apikeys)
2. 注册/登录账号
3. 在API Keys页面创建新的API密钥
4. 复制生成的API密钥

## 2. 配置环境变量

在项目根目录创建 `.env.local` 文件：

```bash
# 智谱AI API配置
ZHIPU_API_KEY=your_actual_api_key_here
```

## 3. API特性

- **模型**: GLM-4.5
- **兼容性**: OpenAI格式API
- **响应时间**: 通常1-3秒
- **超时设置**: 4秒自动fallback到规则引擎
- **费用**: 按token计费，具体价格请查看官方文档

## 4. 功能说明

### 智能评论生成
- 基于音频特征和音乐风格生成专业评论
- 支持中英文双语
- 每条评论30-50字，技术+感性混合
- 自动fallback到规则引擎确保稳定性

### 缓存机制
- 相同特征请求会使用缓存结果
- 缓存命中时响应时间<10ms
- 缓存大小限制100条，避免内存泄漏

### 错误处理
- API超时自动fallback
- 网络错误自动fallback
- 格式错误自动fallback
- 确保系统始终可用

## 5. 测试方法

1. 配置API密钥后重启开发服务器
2. 播放音乐测试弹幕生成
3. 观察控制台日志确认LLM调用状态
4. 测试不同音乐风格的检测准确性

## 6. 注意事项

- API密钥请妥善保管，不要提交到代码仓库
- 建议设置API使用限额避免意外费用
- 开发环境建议使用测试密钥
- 生产环境请使用正式密钥
